{"ast":null,"code":"import _toConsumableArray from\"C:/Users/PC/my-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js\";import _classCallCheck from\"C:/Users/PC/my-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import _createClass from\"C:/Users/PC/my-app/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _inherits from\"C:/Users/PC/my-app/node_modules/@babel/runtime/helpers/esm/inherits.js\";import _createSuper from\"C:/Users/PC/my-app/node_modules/@babel/runtime/helpers/esm/createSuper.js\";import{Component}from'react';import PropTypes from'prop-types';import Spinner from'../spinner/Spinner,';import ErrorMessage from'../errorMessage/ErrorMessage';import MarvelService from'../../services/MarvelService';import'./charList.scss';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CharList=/*#__PURE__*/function(_Component){_inherits(CharList,_Component);var _super=_createSuper(CharList);function CharList(){var _this;_classCallCheck(this,CharList);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_super.call.apply(_super,[this].concat(args));_this.state={charList:[],loading:true,error:false,newItemLoading:false,offset:210,charEnded:false};_this.marvelService=new MarvelService();_this.onRequest=function(offset){_this.onCharListLoading();_this.marvelService.getAllCharacters(offset).then(_this.onCharListLoaded).catch(_this.onError);};_this.onCharListLoading=function(){_this.setState({newItemLoading:true});};_this.onCharListLoaded=function(newCharList){var ended=false;if(newCharList.length<9){ended=true;}_this.setState(function(_ref){var offset=_ref.offset,charList=_ref.charList;return{charList:[].concat(_toConsumableArray(charList),_toConsumableArray(newCharList)),loading:false,newItemLoading:false,offset:offset+9,charEnded:ended};});};_this.onError=function(){_this.setState({loading:false,error:true});};_this.itemRefs=[];_this.setRef=function(ref){_this.itemRefs.push(ref);};_this.focusOnItem=function(id){// Я реализовал вариант чуть сложнее, и с классом и с фокусом\n// Но в теории можно оставить только фокус, и его в стилях использовать вместо класса\n// На самом деле, решение с css-классом можно сделать, вынеся персонажа\n// в отдельный компонент. Но кода будет больше, появится новое состояние\n// и не факт, что мы выиграем по оптимизации за счет бОльшего кол-ва элементов\n// По возможности, не злоупотребляйте рефами, только в крайних случаях\n_this.itemRefs.forEach(function(item){return item.classList.remove('char__item_selected');});_this.itemRefs[id].classList.add('char__item_selected');_this.itemRefs[id].focus();};return _this;}_createClass(CharList,[{key:\"componentDidMount\",value:function componentDidMount(){this.onRequest();}},{key:\"renderItems\",value:// Этот метод создан для оптимизации, \n// чтобы не помещать такую конструкцию в метод render\nfunction renderItems(arr){var _this2=this;var items=arr.map(function(item,i){var imgStyle={'objectFit':'cover'};if(item.thumbnail==='http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg'){imgStyle={'objectFit':'unset'};}return/*#__PURE__*/_jsxs(\"li\",{className:\"char__item\",tabIndex:0,ref:_this2.setRef,onClick:function onClick(){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);},onKeyPress:function onKeyPress(e){if(e.key===' '||e.key===\"Enter\"){_this2.props.onCharSelected(item.id);_this2.focusOnItem(i);}},children:[/*#__PURE__*/_jsx(\"img\",{src:item.thumbnail,alt:item.name,style:imgStyle}),/*#__PURE__*/_jsx(\"div\",{className:\"char__name\",children:item.name})]},item.id);});// А эта конструкция вынесена для центровки спиннера/ошибки\nreturn/*#__PURE__*/_jsx(\"ul\",{className:\"char__grid\",children:items});}},{key:\"render\",value:function render(){var _this3=this;var _this$state=this.state,charList=_this$state.charList,loading=_this$state.loading,error=_this$state.error,newItemLoading=_this$state.newItemLoading,offset=_this$state.offset,charEnded=_this$state.charEnded;var items=this.renderItems(charList);var errorMessage=error?/*#__PURE__*/_jsx(ErrorMessage,{}):null;var spinner=loading?/*#__PURE__*/_jsx(Spinner,{}):null;var content=!(loading||error)?items:null;return/*#__PURE__*/_jsxs(\"div\",{className:\"char__list\",children:[errorMessage,spinner,content,/*#__PURE__*/_jsx(\"button\",{className:\"button button__main button__long\",disabled:newItemLoading,style:{'display':charEnded?'none':'block'},onClick:function onClick(){return _this3.onRequest(offset);},children:/*#__PURE__*/_jsx(\"div\",{className:\"inner\",children:\"load more\"})})]});}}]);return CharList;}(Component);CharList.propsTypes={onCharSelected:PropTypes.func.isRequired};export default CharList;","map":{"version":3,"names":["Component","PropTypes","Spinner","ErrorMessage","MarvelService","CharList","state","charList","loading","error","newItemLoading","offset","charEnded","marvelService","onRequest","onCharListLoading","getAllCharacters","then","onCharListLoaded","catch","onError","setState","newCharList","ended","length","itemRefs","setRef","ref","push","focusOnItem","id","forEach","item","classList","remove","add","focus","arr","items","map","i","imgStyle","thumbnail","props","onCharSelected","e","key","name","renderItems","errorMessage","spinner","content","propsTypes","func","isRequired"],"sources":["C:/Users/PC/my-app/src/components/charList/CharList.js"],"sourcesContent":["import { Component } from 'react';\nimport PropTypes from 'prop-types';\nimport Spinner from '../spinner/Spinner,';\nimport ErrorMessage from '../errorMessage/ErrorMessage';\nimport MarvelService from '../../services/MarvelService';\n\nimport './charList.scss';\n\nclass CharList extends Component {\n\n    state = {\n        charList: [],\n        loading: true,\n        error: false,\n        newItemLoading: false,\n        offset: 210, \n        charEnded: false\n    }\n\n    marvelService = new MarvelService();\n\n    componentDidMount() {\n        this.onRequest();\n    }\n\n    onRequest = (offset) => {\n        this.onCharListLoading();\n        this.marvelService\n            .getAllCharacters(offset)\n            .then(this.onCharListLoaded)\n            .catch(this.onError)\n    }\n\n    onCharListLoading = () => {\n        this.setState({\n            newItemLoading: true\n        })\n    }\n\n    onCharListLoaded = (newCharList) => {\n        let ended = false;\n        if (newCharList.length < 9) {\n            ended = true;\n        }\n\n        this.setState(({offset, charList}) => ({\n            charList: [...charList, ...newCharList],\n            loading: false,\n            newItemLoading: false,\n            offset: offset + 9,\n            charEnded: ended\n        }))\n    }\n\n    onError  = () => {\n        this.setState({\n            loading: false,\n            error: true\n        })\n    }\n\n    // Фокус активности выбора\n    itemRefs = [];\n\n    setRef = (ref) => {\n        this.itemRefs.push(ref);\n    }\n\n    focusOnItem = (id) => {\n        // Я реализовал вариант чуть сложнее, и с классом и с фокусом\n        // Но в теории можно оставить только фокус, и его в стилях использовать вместо класса\n        // На самом деле, решение с css-классом можно сделать, вынеся персонажа\n        // в отдельный компонент. Но кода будет больше, появится новое состояние\n        // и не факт, что мы выиграем по оптимизации за счет бОльшего кол-ва элементов\n\n        // По возможности, не злоупотребляйте рефами, только в крайних случаях\n        this.itemRefs.forEach(item => item.classList.remove('char__item_selected'));\n        this.itemRefs[id].classList.add('char__item_selected');\n        this.itemRefs[id].focus();\n    }\n\n    // Этот метод создан для оптимизации, \n    // чтобы не помещать такую конструкцию в метод render\n    renderItems(arr) {\n        const items =  arr.map((item, i) => {\n            let imgStyle = {'objectFit' : 'cover'};\n            if (item.thumbnail === 'http://i.annihil.us/u/prod/marvel/i/mg/b/40/image_not_available.jpg') {\n                imgStyle = {'objectFit' : 'unset'};\n            }\n            \n            return (\n                <li \n                     className=\"char__item\"\n                    tabIndex={0}\n                    ref={this.setRef}\n                    key={item.id}\n                    onClick={() => {\n                        this.props.onCharSelected(item.id);\n                        this.focusOnItem(i);\n                    }}\n                    onKeyPress={(e) => {\n                        if (e.key === ' ' || e.key === \"Enter\") {\n                            this.props.onCharSelected(item.id);\n                            this.focusOnItem(i);\n                        }\n                    }}> \n                        <img src={item.thumbnail} alt={item.name} style={imgStyle}/>\n                        <div className=\"char__name\">{item.name}</div>\n                </li>\n            )\n        });\n        // А эта конструкция вынесена для центровки спиннера/ошибки\n        return (\n            <ul className=\"char__grid\">\n                {items}\n            </ul>\n        )\n    }\n\n    render() {\n\n        const {charList, loading, error, newItemLoading, offset, charEnded} = this.state;\n        \n        const items = this.renderItems(charList);\n\n        const errorMessage = error ? <ErrorMessage/> : null;\n        const spinner = loading ? <Spinner/> : null;\n        const content = !(loading || error) ? items : null;\n\n        return (\n            <div className=\"char__list\">\n                {errorMessage}\n                {spinner}\n                {content}\n                <button \n                    className=\"button button__main button__long\"\n                    disabled={newItemLoading}\n                    style={{'display': charEnded ? 'none' : 'block'}}\n                    onClick={() => this.onRequest(offset)}>\n                    <div className=\"inner\">load more</div>\n                </button>\n            </div>\n        )\n    }\n}\n\nCharList.propsTypes = {\n    onCharSelected: PropTypes.func.isRequired\n}\n\n\nexport default CharList;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}